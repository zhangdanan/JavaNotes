https://mp.weixin.qq.com/s/Cl5jL-5hQeeKtAS8oMpxbQ

# 2019-5-10-Nginx

### 什么是Nginx

Nginx (engine x) 是一个高性能的 HTTP 和反向代理服务。Nginx 是由伊戈尔·赛索耶夫 为俄罗斯访问量第二的 Rambler.ru 站点（俄文：Рамблер）开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。 Nginx 是一个很强大的高性能 Web 和反向代理服务，它具有很多非常优越的特性：在连接高并发的情况下，Nginx 是 Apache 服务不错的替代品：Nginx 在美国是做虚拟主机生意的老板们经常选择的软件平台之一。 

### Nginx的作用是什么

1. http 协议代理 
2. 搭建虚拟主机 
3. 服务的反向代理 
4. 在反向代理中配置集群的负载均衡 

### 正向代理与反向代理区别

##### 什么是正向代理

为客户端做代理，正向代理，意思是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。

##### 什么是反向代理

反向代理（Reverse Proxy）方式是指以代理服务器来接受 internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。 

##### 两者之间的区别是什么

###### 位置不同 

正向代理，架设在客户机和目标主机之间； 
反向代理，架设在服务器端； 

###### 代理对象不同 

正向代理，代理客户端，服务端不知道实际发起请求的客户端； 
反向代理，代理服务端，客户端不知道实际提供服务的服务端；

### 安装Nginx

### 操作Nginx

##### 如何启动Nginx

##### 如何停止Nginx

##### 如何重启Nginx

### 虚拟主机介绍

##### 什么是虚拟主机

虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供 www 服务，这样就可以实现一台主机对外提供多个web 服务，每个虚拟主机之间是独立的，互不影响的。 虚拟主机技术是互联网服务器采用的节省服务器硬件成本的技术，虚拟主机技术主要应用于 HTTP（Hypertext Transfer Protocol，超文本传输协议）服务，将一台服务器的某项或者全部服务内容逻辑划分为多个服务单位，对外表现为多个服务器，从而充分利用服务器硬件资源。

##### Nginx支持哪三种虚拟主机配置

1. 基于 IP 的虚拟主机 
2. 基于端口的虚拟主机 
3. 基于域名的虚拟主机 

### Nginx反向代理-配置负载均衡

##### 什么是负载均衡

负载均衡建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。 负载均衡，英文名称为 Load Balance，其意思就是分摊到多个操作单元上，进行执行，例如 Web 服务器、FTP 服务器、企业关键应用服务器和其它关键任务 服务器等，从而共同完成工作任务。

##### Nginx中所支持的负载均衡策略有哪些

###### 轮询

每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。 

###### 指定权重

指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。

###### IP绑定ip_hash

每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。

# Windows下的nginx的安装与使用

### 1.下载nginx

官网地址：http://nginx.org/en/download.html

下载之后解压

### 2.启动nginx

启动nginx的方法有两种

1. 直接双击解压后文件夹中的nginx.exe，双击后会发现一个黑色的弹窗一闪而过

2. 打开cmd命令行窗口，切换到nginx解压目录下，输入命令nginx.exe或者start nginx，回车即可

   

### 3.检查nginx是否启动成功

直接在浏览器地址栏输入网址http://localhost:80,回车，出现以下页面说明启动成功。

![image-20200329155004692](C:\Users\sloth\AppData\Roaming\Typora\typora-user-images\image-20200329155004692.png)

也可以在命令行中输入命令tasklist /fi "imagename eq nginx.exe"，出现以下界面说明启动成功

![image-20200329155441662](C:\Users\sloth\AppData\Roaming\Typora\typora-user-images\image-20200329155441662.png)

nginx的配置文件在conf目录下的nginx.conf,默认配置的nginx监听端口为80，如果80端口被占用的话，可以修改为未被占用的端口即可

![image-20200329163635769](C:\Users\sloth\AppData\Roaming\Typora\typora-user-images\image-20200329163635769.png)

### 4.关闭nginx

如果使用cmd命令窗口启动nginx，关闭cmd窗口是不能结束nginx进程的，可以使用以下的命令

1. 输入nginx命令 nginx -s stop（快速停止nginx）或 nginx -s quit（完整有序的停止nginx）
2. 使用taskkill  taskkill /f /t /im nginx.exe

### 5.使用nginx代理服务器做负载均衡

我们可以修改nginx的配置文件nginx.conf 达到访问nginx代理服务器时跳转到指定服务器的目的，即通过proxy_pass 配置请求转发地址，即当我们依然输入http://localhost:80 时，请求会跳转到我们配置的服务器

 

![img](https://images2018.cnblogs.com/blog/1337134/201802/1337134-20180228000738277-1150438810.png)

同理，我们可以配置多个目标服务器，当一台服务器出现故障时，nginx能将请求自动转向另一台服务器，例如配置如下：

![img](https://images2018.cnblogs.com/blog/1337134/201802/1337134-20180228001312039-1721872808.png)

当服务器 localhost:8080 挂掉时，nginxnginx能将请求自动转向服务器 192.168.101.9:8080 。上面还加了一个weight属性，此属性表示各服务器被访问到的权重，weight

越高被访问到的几率越高。

### 6.nginx配置静态资源

 将静态资源（如jpg|png|css|js等）放在如下配置的f:/nginx-1.12.2/static目录下，然后在nginx配置文件中做如下配置(注意：静态资源配置只能放在 location / 中)，浏览器中访问 http://localhost:80/1.png 即可访问到 f:/nginx-1.12.2/static目录下的 1.png图片

![img](https://img2018.cnblogs.com/blog/1337134/201811/1337134-20181130165833621-1765529068.png)

 

参考链接：https://www.cnblogs.com/jiangwangxiang/p/8481661.html